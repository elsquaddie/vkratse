# ‚ö° YooKassa - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

**–î–ª—è:** –í–ª–∞–¥–µ–ª—å—Ü–∞ –±–æ—Ç–∞ (–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç)
**–¶–µ–ª—å:** –ë—ã—Å—Ç—Ä–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ YooKassa

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏ API-–∫–ª—é—á–∏ (1 –º–∏–Ω)

1. –ó–∞–π–¥–∏ –≤ https://yookassa.ru/my/merchant/integration/api-keys
2. –°–∫–æ–ø–∏—Ä—É–π:
   - **shopId** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123456`)
   - **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_ABC123xyz...`)

**‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π –¢–ï–°–¢–û–í–´–ï –∫–ª—é—á–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞!**

### –®–∞–≥ 2: –î–æ–±–∞–≤—å –≤ Vercel (2 –º–∏–Ω)

1. –ó–∞–π–¥–∏ –≤ https://vercel.com/ ‚Üí –ü—Ä–æ–µ–∫—Ç `vkratse` ‚Üí Settings ‚Üí Environment Variables
2. –î–æ–±–∞–≤—å 2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
YOOKASSA_SHOP_ID = <—Ç–≤–æ–π shopId>
YOOKASSA_SECRET_KEY = <—Ç–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á>
```

3. Environments: –æ—Ç–º–µ—Ç—å **–≤—Å–µ** (Production, Preview, Development)
4. –ù–∞–∂–º–∏ **Save**

### –®–∞–≥ 3: Redeploy (1 –º–∏–Ω)

1. Vercel ‚Üí Deployments
2. –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π ‚Üí "..." ‚Üí **Redeploy**
3. –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (~30 —Å–µ–∫)

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π Webhook (1 –º–∏–Ω)

1. YooKassa ‚Üí –ú–∞–≥–∞–∑–∏–Ω ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Üí HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
2. URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   ```
   https://vkratse.vercel.app/api/yookassa_webhook
   ```
3. –°–æ–±—ã—Ç–∏—è: ‚úÖ `payment.succeeded`, ‚úÖ `payment.canceled`
4. –§–æ—Ä–º–∞—Ç: **JSON**
5. –°–æ—Ö—Ä–∞–Ω–∏

---

## üß™ –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å `/premium`
3. –ù–∞–∂–º–∏ **"üí≥ –ö—É–ø–∏—Ç—å Pro"**
4. –ù–∞–∂–º–∏ **"üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞"**

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ—è–≤–∏–ª–∞—Å—å –∫–Ω–æ–ø–∫–∞ "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å"
- ‚úÖ –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ YooKassa

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Vercel
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ redeploy –≤—ã–ø–æ–ª–Ω–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel

### –¢–µ—Å—Ç 2: –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂

1. –ù–∞–∂–º–∏ "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å"
2. –ò—Å–ø–æ–ª—å–∑—É–π **—Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É:**
   - –ù–æ–º–µ—Ä: `4111 1111 1111 1111`
   - –°—Ä–æ–∫: `12/25`
   - CVV: `123`
   - –ò–º—è: `TEST`
3. –ù–∞–∂–º–∏ "–û–ø–ª–∞—Ç–∏—Ç—å"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–ª–∞—Ç–µ–∂ –ø—Ä–æ—à–µ–ª
- ‚úÖ –ß–µ—Ä–µ–∑ 1-5 —Å–µ–∫ –±–æ—Ç –ø—Ä–∏—Å–ª–∞–ª: "üéâ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!"
- ‚úÖ `/mystatus` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "üíé Pro"

**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel ‚Üí Functions ‚Üí `yookassa_webhook`
- –ü—Ä–æ–≤–µ—Ä—å YooKassa ‚Üí –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π ‚Üí –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞
- –ü—Ä–æ–≤–µ—Ä—å Supabase ‚Üí `subscriptions` ‚Üí –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å

### –¢–µ—Å—Ç 3: –†—É—á–Ω–∞—è –≤—ã–¥–∞—á–∞ Pro

1. –£–∑–Ω–∞–π —Å–≤–æ–π Telegram ID:
   - –û—Ç–ø—Ä–∞–≤—å `/mystatus` –±–æ—Ç—É
   - –ò–ª–∏ –∑–∞–π–¥–∏ –≤ Supabase ‚Üí `user_settings` ‚Üí —Å–∫–æ–ø–∏—Ä—É–π `user_id`

2. –û—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É:
   ```
   /grantpro <—Ç–≤–æ–π_user_id> 30
   ```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ—Ç –ø—Ä–∏—Å–ª–∞–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- ‚úÖ –ë–æ—Ç –ø—Ä–∏—Å–ª–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Pro
- ‚úÖ `/mystatus` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "üíé Pro"

---

## üîß –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ 3 —Ç–µ—Å—Ç–∞ –≤—ã—à–µ
2. –ü–æ–ø—Ä–æ—Å–∏ –¥—Ä—É–≥–∞ –∫—É–ø–∏—Ç—å Pro —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ YooKassa

### –î–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞:
1. –ü—Ä–æ–π–¥–∏ –ø–æ–ª–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ YooKassa (–æ—Ç–ø—Ä–∞–≤—å –¥–æ–∫—É–º–µ–Ω—Ç—ã)
2. –î–æ–∂–¥–∏—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è (1-3 –¥–Ω—è)
3. –ü–æ–ª—É—á–∏ **–±–æ–µ–≤—ã–µ –∫–ª—é—á–∏** (–Ω–µ —Ç–µ—Å—Ç–æ–≤—ã–µ!)
4. –û–±–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Vercel –Ω–∞ –±–æ–µ–≤—ã–µ –∫–ª—é—á–∏
5. Redeploy –ø—Ä–æ–µ–∫—Ç–∞

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** [YOOKASSA_SETUP_GUIDE.md](./YOOKASSA_SETUP_GUIDE.md)

---

## üö® Troubleshooting

### –ö–Ω–æ–ø–∫–∞ "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞" –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** YooKassa –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Vercel
echo $YOOKASSA_SHOP_ID    # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –ø—É—Å—Ç—ã–º
echo $YOOKASSA_SECRET_KEY # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –ø—É—Å—Ç—ã–º

# Redeploy –ø—Ä–æ–µ–∫—Ç–∞
vercel deploy --prod
```

### –û—à–∏–±–∫–∞ "–û–ø–ª–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–µ API-–∫–ª—é—á–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –°–∫–æ–ø–∏—Ä—É–π –∫–ª—é—á–∏ –∑–∞–Ω–æ–≤–æ –∏–∑ YooKassa
- –û–±–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Vercel
- Redeploy

### –ü–ª–∞—Ç–µ–∂ –ø—Ä–æ—à–µ–ª, –Ω–æ Pro –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞—Å—å

**–ü—Ä–∏—á–∏–Ω–∞:** Webhook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
1. Vercel ‚Üí Functions ‚Üí `yookassa_webhook` ‚Üí –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
2. YooKassa ‚Üí –ò—Å—Ç–æ—Ä–∏—è ‚Üí Webhook —Å—Ç–∞—Ç—É—Å
3. –ï—Å–ª–∏ webhook –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—å URL webhook
4. –†—É—á–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è: `/grantpro <user_id> 30`

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ –ë–î (Supabase SQL Editor):

```sql
-- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ Pro-–ø–æ–¥–ø–∏—Å–∫–∏
SELECT user_id, tier, expires_at, payment_method, created_at
FROM subscriptions
WHERE is_active = true AND tier = 'pro'
ORDER BY created_at DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ø–æ—Å–æ–±–∞–º –æ–ø–ª–∞—Ç—ã
SELECT payment_method, COUNT(*) as count
FROM subscriptions
WHERE tier = 'pro'
GROUP BY payment_method;
```

### –í—ã–¥–∞—á–∞ Pro –¥—Ä—É–∑—å—è–º:

```bash
# 30 –¥–Ω–µ–π Pro
/grantpro <user_id> 30

# 1 –≥–æ–¥ Pro (–¥–ª—è VIP)
/grantpro <user_id> 365
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-17
**–í–µ—Ä—Å–∏—è:** 1.0

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –°–º. [YOOKASSA_SETUP_GUIDE.md](./YOOKASSA_SETUP_GUIDE.md) ‚Äî –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
