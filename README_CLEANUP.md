# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É cleanup —Å–∫—Ä–∏–ø—Ç–∞

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç
`scripts/cleanup_old_messages.py` —É–¥–∞–ª—è–µ—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ `MESSAGE_RETENTION_DAYS` (2 –¥–Ω—è) –∏–∑ –ë–î.

## –ó–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?
–ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ —á–∞—Ç–µ. –ï—Å–ª–∏ –≤ —á–∞—Ç–µ –¥–∞–≤–Ω–æ –Ω–µ –ø–∏—Å–∞–ª–∏ - —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è. –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç –∏—Ö –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ.

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (–Ω–∞ —Å–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip3 install -r requirements.txt
```

### 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

–°–∫–æ–ø–∏—Ä—É–π `.env.example` –≤ `.env`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env`:

```bash
# .env
TELEGRAM_BOT_TOKEN=—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
ANTHROPIC_API_KEY=—Ç–≤–æ–π_api_key
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=—Ç–≤–æ–π_supabase_key
MESSAGE_RETENTION_DAYS=2
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç

```bash
python3 scripts/cleanup_old_messages.py
```

### –ß—Ç–æ —É–≤–∏–¥–∏—à—å

```
============================================================
Starting cleanup of old messages
Retention policy: 2 days
============================================================
Deleting messages older than: 2025-11-12T16:00:00+00:00

Fetching statistics before cleanup...

Found 234 old messages across 5 chats:
  Chat -1001234567890: 120 messages
  Chat -1009876543210: 80 messages
  Chat -1005555555555: 20 messages
  ...

============================================================
Delete 234 messages? [y/N]: y

Deleting old messages...
‚úÖ Successfully deleted 234 old messages

üìä Remaining messages in database: 50

============================================================
‚úÖ Cleanup completed successfully!
============================================================
```

### 4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç —Å–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º:
- –í–≤–µ–¥–∏ `y` —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
- –í–≤–µ–¥–∏ `n` (–∏–ª–∏ Enter) —á—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –î–û —É–¥–∞–ª–µ–Ω–∏—è
- –£–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–æ–≤—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è)
- –ù–ï —É–¥–∞–ª—è–µ—Ç –ª–∏—á–Ω–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–∞—Ç–æ–≤

## –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å?

- **–°–µ–π—á–∞—Å:** —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å 9 –Ω–æ—è–±—Ä—è)
- **–ü–æ—Ç–æ–º:** –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –µ—Å–ª–∏ –ë–î –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è

## –ù—É–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ?

**–ù–ï–¢!** –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.

Cleanup —Å–∫—Ä–∏–ø—Ç –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ:
1. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `MESSAGE_RETENTION_DAYS`
2. –î–ª—è –æ—á–∏—Å—Ç–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
3. –î–ª—è —Ä–∞–∑–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
